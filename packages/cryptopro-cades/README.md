# Данный пакет больше не поддерживается

Сервис переехал в закрытый контур Астрал-Софт.

# @astral/cryptopro-cades

Библиотека для взаимодействия с [КриптоПро ЭЦП Browser plug-in](https://www.cryptopro.ru/products/cades/plugin)

## Установка

```bash
npm install @astral/cryptopro-cades
```

## API surface

- sign - подпись контента файла (CMS, прикрепленный или открепленный).
- signEx - подпись контента файла (CMS, прикрепленный или открепленный). Добавлена возможность гибко указать опции включения в результат цепочки сертификатов.
    Включать всю цепочку сертификатов, Включать всю цепочку кроме корневого (по-умолчанию), Включать только конечный сертификат.
- signHash - подпись хэша файла (CMS detached). Хэш должен быть вычислен по Gost3411_2012 ГОСТу (256 или 512 в зависимости от алгоритма сертификата).
- signHashEx - подпись хэша файла (CMS detached). Хэш должен быть вычислен по Gost3411_2012 ГОСТу (256 или 512 в зависимости от алгоритма сертификата).
    Добавлена возможность гибко указать опции включения в результат цепочки сертификатов.
    Включать всю цепочку сертификатов, Включать всю цепочку кроме корневого (по-умолчанию), Включать только конечный сертификат.
- signHashRaw - подпись хэша указанным сертификатом в "сыром" формате. Хэш должен быть вычислен по Gost3411_2012 ГОСТу (256 или 512 в зависимости от алгоритма сертификата).
- signXml - подпись файла (XmlDSig). Параметром управляется тип Enveloped, Enveloping, Template.
- decrypt - расшифровка файла (CMS).
- encrypt - шифрование файла (CMS).
- findCertificateBySkid - поиск по значению из расширения сертификата SubjectKeyId (oid '2.5.29.14').
- findCertificateBySkidFromContainers - поиск по значению из расширения сертификата SubjectKeyId (oid '2.5.29.14').
    Поиск производится в отличие от предыдущей функции не по хранилищу сертификатов, а по контейнерам, доступным в данный момент.
- findCertificateByThumprint - поиск сертификата по отпечатку (хэш sha-1).
- getCertificates - получение списка сертификатов, с возможностью указать тип хранилища для поиска (токены, реестры или всё и сразу).
- getCertificatesFromContainers - получение списка сертификатов.
    Поиск производится в отличие от предыдущей функции не по хранилищу сертификатов, а по контейнерам, доступным в данный момент.

  - сертификаты имеют в составе базовую информацию:
    - certificateBase64Data
    - issuer
      - inn
      - innLe
      - commonName
    - subject
      - commonName
      - surname
      - name
      - country
      - region
      - locality
      - street
      - organization
      - department
      - post
      - ogrnip
      - ogrn
      - snils
      - innLe
      - inn
      - email
    - subjectName
    - thumbprint
    - subjectKeyId
    - name
    - providerName, providerType
    - hasPrivateKey
    - isGost
    - notBefore, notAfter
    - algorithm

- checkPlugin - проверка доступности КриптоПРО Браузер плагина.
- checkIsValidSystemSetup - проверка корректности рабочего места - наличие криптопровайдера, плагина, и минимальных версий.
- getCryptoProviders - получение списка криптопровайдеров установленных на компьютере пользователя. Название, тип, версия.
- getSystemInfo - получение информации о системе пользователя - версия КриптоПро ЭЦП Browser plug-in, версия CSP (VipNet или CryptoPro)
- getLicensesState - получение информации о состоянии лицензий продуктов КриптоПро - CSP, OCSP Client, TSP Client. C VipNet CSP вернет null'ы.
- pluginConfig - возможность включить вывод отладочной информации, подписываться на все создаваемые исключения, отключать проверку корректности системы, ограничивать тип криптопровайдера которым можно пользоваться, его версии.
- getReaders - получение списка доступных считывателей (в т.ч. вставленных токенов) с помощью CryptoPro CSP.
- createCSR - формирование контейнера и запроса на сертификат за один криптосеанс. Работает с VipNet и CryptoPro
- installCertificate - устанавливает цепочку сертификатов в хранилище
